<!DOCTYPE html>
<html>
  <head>
    <title>Near by Recommendation System</title>
    <link rel="stylesheet" href="/css/styles.css"/>
    <link rel="stylesheet" href="/css/prism.css"/>
  </head>

<body>
  <nav class="navbar">    <!--See .navbar in styles.css-->
    <ul>
      <li><a href="/">Home</a></li>
      <li><a href="#">Our team</a></li>
      <li><a href="#">Projects</a></li>
      <li><a href="/contact.html">Contact</a></li>
      <li>
        <form id="searchForm">
            <input type="search" id="searchInput" name="q" placeholder="Search site" />
            <input type="submit" value="Go!" />
        </form>
        </li>
    </ul>
  </nav>

  <aside class="sidebar">
    <a href="#what">What</a>
    <a href="#req">Requirements</a>
    <a href="#boe">BOE</a>
    <a href="#systemapis">System APIs</a>
    <a href="#database">Databases</a>
  </aside>

  <main>
    <article style="margin-left:200px;">
        <h3 id="what">What is Yelp / Near by Recommendation System</h3>
        <p>
            - Used to discover nearby places(eg: schools near me), events, restaurants, theaters, etc.<br>
            - Yelp App on phone sends (lattitude,longitude) of user’s device and yelp server sends locations within 
            10 km radius of (lattitude,longitude) to the user.<br>
            - (lattitude,longitude) are like coordinates of point on earth.
        </p>

        <h3 id="req">1. Requirements</h3>
        <h4>Functional</h4>
        <dd>CRUD(Create=POST, Read=GET, Update=PUT, Delete=DELETE)</dd>
        <dl id="req1"> 1. Add places //POST</dl>
        <dl id="req2"> 2. Update Places</dl>
        <dl id="req3"> 3. Delete places</dl>
        <dl id="req4"> 4. Get Places. Given (longitude,lattitude) nearby places should be listed for given radius. //GET</dl>
        <dl id="req5"> 5. POST. Users should be able to give reviews, ratings, open/close times, pictures etc.</dl>

        <h3 id="boe">2. BOE</h3>
        <dl><strong>Storage Estimates:</strong></dl>
        <p>
            - 200M~300M business listings are present on google<br>
            - Each place {string name, string address, double lat, double long, `vector<string> reviews`, string photos_url}  = 2000 KB<br>
            - 300M * 2000k = 60 PB / year<br>
            - User Reviews,Photos,Videos will keep on increasing. Suppose becomes 5 times per year.  300PB<br>
            - New Businesses also gets added, old fade away. Suppose from last year it becomes twice.  120PB<br>
            500 PB/year<br>
            5 years = 2 Exabytes            
        </p>

        <dl><strong>QPS:</strong></dl>
        <p>
            - Assuming 100k user are accessing per sec<br>
            - This may increase in peak season, and may decline/remain steady other times
        </p>

        <dl><strong>Bandwidth Estimates:</strong></dl>
        <p>
            - 100k req/s.<br>
            - 1 GET request = 2KB<br>
            - 1 UPDATE request = 4KB  //Avg of 2=3KB<br>
          
            Incoming bytes = 100k x 3k = 300MBytes/sec<br>
            Outgoing bytes = 100k x (sizeof 1 listing) = 100k x 2000 KB(calculated above) = 20GB/sec            
        </p>
        
        <h3 id="systemapis">3. System APIs</h3>
        <dl><strong>1. <a href="#req1">add_place = HTTP POST</a></strong></dl>
        <pre>
                POST https://url/v1/add_place
                header {
                    Authorization: {Bearer "API_KEY_TOKEN"},
                    lat: "",
                    longitude: ""
                }
                body {
                    name, description, picture_url, video_url
                }
            </pre>

            <dl><strong>2. <a href="#req2">update_place = HTTP PUT Place/person/thing information</a></strong></dl>
            <pre>
                GET https://url/v1/search_place
                header {
                  Authorization: {Bearer "API_KEY_TOKEN"},
                  sort: optional,
                  business-id: id    //unique key
                }
                body {              //Server will compare the data and update the changed
                  name, description, picture_url, video_url,
                  userLocation {
                    lat: "",
                    long: "",
                  },
                }
            </pre>

            <dl><strong>4. <a href="#req4">search_place //HTTP GET. Place/person/thing information</a></strong></dl>
            <pre>
                GET https://url/v1/search_place
                header {
                  Authorization: {Bearer "API_KEY_TOKEN"},
                  userLocation {
                    lat: "",
                    long: "",
                  },
                  radius: 10km,  //default
                  sort: optional,
                  category: optional
                }
                //Returns json:
                {
                  {            //business-1
                    name: business-name
                    photo: photo_url,
                    ratings: array<ratings>,
                    open close time: string
                  },
                  {
                    //business-2
                  },
                }
            </pre>

            <h3 id="database">3. Databases</h3>
            <dt>
                Following are entities in system: Place, Place_Owner(who adds entry), Reviews, Photos, Videos
            </dt>

            <dl><strong>1. Place table (indexing for faster searching)</strong></dl>
            <pre>
| ownerID(fk)[indexed] | lattitude | longitude | placeID(pk) | Description | categoryId(fk) | lastupdated_timestamp[indexed] |

ownerID: id of person who created the entry
lattitude: Geographic coordinate specifying north–south position of a point on the Earth's surface.
longitude: Geographic coordinate specifying east–west position of a point on the Earth's surface.
    - (lattitude, longitude): precise location of features on the surface of the Earth.
placeID(8 bytes): Uniquely identifies a location. LocationId is taken 8 bytes(64 bits) considering future in mind.
    - 2<sup>64</sup> = Huge number of locations
Description(512 bytes)
Category(1 byte): E.g., coffee shop, restaurant, theater, etc.                
            </pre>

            <br>
            <dl><strong>2. Place_owner table</strong></dl>
            <pre>
| ownerID(pk) | name | email | secret_key | placeID(fk) | created_timestamp |

placeId: locations this owner owns
created_timestamp: profile created by owner at this time                
            </pre>

            <br>
            <dl><strong>3. Reviews table</strong></dl>
            <pre>
| review_id(pk) | creator_name | creator_email | review_description | placeID(fk) | created_timestamp |           
            </pre>

            <br>
            <dl><strong>4. Place Photo table</strong></dl>
            <dt>photos stored on object store</dt>
            <pre>
| photo_id(pk) | active | photo_url | placeID(fk) | created_timestamp | marked_inactive_timestamp |

active: Is photo active on website, ie getting displayed. We will remove photo from db
    after 30 days, if marks inactive
photo_url:
            </pre>

            <br>
            <dl><strong>5. Place video table</strong></dl>
            <dt>videos stored on object store</dt>

            <br>
            <dl><strong>6. Reviews table</strong></dl>
            <dt>Reviews stored on object store</dt>
            <pre>
| reviewId(pk) | review-text-url | placeid(fk) | stars |
            </pre>

            <br>
            <dl><strong>7. Category Table</strong></dl>
            <pre>
| categoryId(pk) | Category-text |

Benefits of keeping seperate Category table:
- Add/update category without affecting place table
            </pre>
    </article>
  </main>
</body>
</html>
